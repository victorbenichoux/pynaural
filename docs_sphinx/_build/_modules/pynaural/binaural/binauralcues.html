<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pynaural.binaural.binauralcues &mdash; Pynaural 0.1 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/agogo.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Pynaural 0.1 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
    <div class="header-wrapper">
      <div class="header">
        <div class="headertitle"><a
          href="../../../index.html">Pynaural 0.1 documentation</a></div>
        <div class="rel">
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for pynaural.binaural.binauralcues</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy.fft</span> <span class="kn">import</span> <span class="n">fft</span><span class="p">,</span> <span class="n">fftfreq</span><span class="p">,</span> <span class="n">ifft</span>

<span class="kn">from</span> <span class="nn">pynaural.utils.debugtools</span> <span class="kn">import</span> <span class="n">log_debug</span>
<span class="kn">from</span> <span class="nn">pynaural.signal.sounds</span> <span class="kn">import</span> <span class="n">Sound</span>
<span class="kn">from</span> <span class="nn">pynaural.signal.impulseresponse</span> <span class="kn">import</span> <span class="n">ImpulseResponse</span>
<span class="kn">from</span> <span class="nn">pynaural.signal.filterbanks</span> <span class="kn">import</span> <span class="n">gammatone_correlate</span>
<span class="kn">import</span> <span class="nn">pynaural.signal.fitting</span> <span class="kn">as</span> <span class="nn">fit</span>
<span class="kn">from</span> <span class="nn">brian.hears</span> <span class="kn">import</span> <span class="n">Gammatone</span><span class="p">,</span> <span class="n">Repeat</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;itdp_itdg_idi&#39;</span><span class="p">,</span><span class="s">&#39;itd_xcorr&#39;</span><span class="p">,</span> <span class="s">&#39;itd_ild_bare&#39;</span><span class="p">,</span> <span class="s">&#39;itd_ild_xcorr&#39;</span><span class="p">,</span>
            <span class="s">&#39;itd_onset&#39;</span><span class="p">,</span> <span class="s">&#39;ild&#39;</span><span class="p">,</span> <span class="s">&#39;bb_itd_ild_xcorr&#39;</span><span class="p">,</span> <span class="s">&#39;ild_bare&#39;</span><span class="p">,</span> <span class="s">&#39;ipd&#39;</span><span class="p">]</span>
<span class="c">######################################################</span>
<span class="c">################## ITD computation  ##################</span>
<span class="c">######################################################</span>

<span class="c">## Individual ITD functions</span>
<span class="c"># XCORR</span>
<span class="c"># Phase</span>
<span class="c"># fit: itdp, itdg, idi</span>

<span class="c"># The following section deals with ITD estimation, the main wrapper function and the individual </span>
<span class="k">def</span> <span class="nf">itdp_itdg_idi</span><span class="p">(</span><span class="n">ipds</span><span class="p">,</span> <span class="n">cfs</span><span class="p">,</span> <span class="n">samplerate</span><span class="p">,</span> 
                  <span class="n">only_posfreqs</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>  <span class="n">Q</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">slopeguess</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> 
                  <span class="n">itdg_extent</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-.</span><span class="mo">001</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> 
                  <span class="n">fcut_lf</span> <span class="o">=</span> <span class="mf">400.</span><span class="p">,</span> <span class="n">cut_lf</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the phase ITD, ITDp, the group ITD, ITDg and the IDI around the given center frequencies, and from the given ipd pattern.</span>

<span class="sd">    Units:</span>
<span class="sd">    ITDg: is in rad by Hz, i.e must be divided by 2 pi to get a value in second</span>
<span class="sd">    ITDp: is in rad by Hz.</span>
<span class="sd">    IDI: is in rad</span>

<span class="sd">    * Arguments</span>
<span class="sd">    </span>
<span class="sd">    ITDg and IDI are computed by a circular linear regression around the cf points. </span>
<span class="sd">    cfs is the array of center frequencies.</span>
<span class="sd">    The bandwidth are controlled via the &#39;Q&#39; kwdarg.</span>

<span class="sd">    the cut_lf and fcut_lf kwdargs linearize the ipd in below the fcut lf frequency. As a result the ipd is smoothed in lf and estimation is more consistent</span>

<span class="sd">    ipds is 1D array of ipds, at the usual fftfreq-like positions.</span>
<span class="sd">    Note: if only_posfreqs is True then it is assumed that ipds contains the ipd spectrum for positive frequencies only</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">itdp</span><span class="p">,</span> <span class="n">itdg</span><span class="p">,</span> <span class="n">idi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cfs</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cfs</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cfs</span><span class="p">))</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">only_posfreqs</span><span class="p">:</span>
        <span class="n">freqs</span> <span class="o">=</span> <span class="n">fftfreq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ipds</span><span class="p">))</span> <span class="o">*</span> <span class="n">samplerate</span>
        <span class="n">posfreqs</span> <span class="o">=</span> <span class="n">freqs</span><span class="p">[</span><span class="n">freqs</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">posipds</span> <span class="o">=</span>  <span class="n">ipds</span><span class="p">[</span><span class="n">freqs</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">freqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">samplerate</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ipds</span><span class="p">))</span>
        <span class="n">posfreqs</span> <span class="o">=</span> <span class="n">freqs</span>
        <span class="n">posipds</span> <span class="o">=</span> <span class="n">ipds</span>

    <span class="k">if</span> <span class="n">cut_lf</span><span class="p">:</span>
        <span class="n">lfcut_freqs</span> <span class="o">=</span> <span class="p">(</span><span class="n">posfreqs</span> <span class="o">&lt;</span> <span class="n">fcut_lf</span><span class="p">)</span>
        <span class="n">lfcut_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">lfcut_freqs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">new_posipds</span> <span class="o">=</span> <span class="n">posipds</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">new_posipds</span><span class="p">[</span><span class="n">lfcut_ids</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">posipds</span><span class="p">[</span><span class="n">lfcut_ids</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">lfcut_ids</span><span class="p">))</span>
        <span class="n">posipds</span> <span class="o">=</span> <span class="n">new_posipds</span>
        
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">cf</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cfs</span><span class="p">):</span>
        <span class="n">fhigh</span><span class="p">,</span> <span class="n">flow</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">Q</span><span class="p">))</span><span class="o">*</span><span class="n">cf</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">Q</span><span class="p">))</span><span class="o">*</span><span class="n">cf</span>
        <span class="n">curfreq_ids</span> <span class="o">=</span> <span class="p">(</span><span class="n">posfreqs</span><span class="o">&gt;</span> <span class="n">flow</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">posfreqs</span> <span class="o">&lt;</span> <span class="n">fhigh</span><span class="p">)</span>
        <span class="n">curfreqs</span> <span class="o">=</span> <span class="n">posfreqs</span><span class="p">[</span><span class="n">curfreq_ids</span><span class="p">]</span>
        <span class="n">curipds</span> <span class="o">=</span> <span class="n">posipds</span><span class="p">[</span><span class="n">curfreq_ids</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">slopeguess</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">):</span>
            <span class="n">itdg</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">idi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">fit</span><span class="o">.</span><span class="n">circular_linear_regression</span><span class="p">(</span><span class="n">curfreqs</span><span class="p">,</span> 
                                                             <span class="n">curipds</span><span class="p">,</span> 
                                                             <span class="n">slope_extent</span> <span class="o">=</span> <span class="n">itdg_extent</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">slopeguess</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">guess</span> <span class="o">=</span> <span class="n">fit</span><span class="o">.</span><span class="n">guess_init</span><span class="p">(</span><span class="n">curfreqs</span><span class="p">,</span> <span class="n">curipds</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">slopeguess</span> <span class="o">==</span> <span class="s">&#39;puredelay&#39;</span><span class="p">:</span>
                <span class="n">guess</span> <span class="o">=</span> <span class="n">fit</span><span class="o">.</span><span class="n">puredelay_fit</span><span class="p">(</span><span class="n">curfreqs</span><span class="p">,</span> <span class="n">curipds</span><span class="p">,</span> <span class="n">init</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">guess</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">itdg</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">idi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">fit</span><span class="o">.</span><span class="n">circular_linear_regression</span><span class="p">(</span><span class="n">curfreqs</span><span class="p">,</span> 
                                                             <span class="n">curipds</span><span class="p">,</span> 
                                                             <span class="n">slopeguess</span> <span class="o">=</span> <span class="n">guess</span><span class="p">)</span>
    <span class="n">itdp</span> <span class="o">=</span> <span class="n">itdg</span> <span class="o">+</span> <span class="n">idi</span><span class="o">/</span><span class="n">cfs</span>
    <span class="k">return</span> <span class="n">itdp</span><span class="p">,</span> <span class="n">itdg</span><span class="p">,</span> <span class="n">idi</span>

<span class="c">######## XCORR ITD</span>

<div class="viewcode-block" id="itd_xcorr"><a class="viewcode-back" href="../../../user/binaural.html#pynaural.binaural.binauralcues.itd_xcorr">[docs]</a><span class="k">def</span> <span class="nf">itd_xcorr</span><span class="p">(</span><span class="n">hrir</span><span class="p">,</span><span class="n">cfs</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Computes ITDs by looking at the cross correlation between channels</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">itds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">cfs</span><span class="p">),</span> <span class="n">hrir</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">hrir</span><span class="o">.</span><span class="n">ncoordinates</span><span class="p">):</span>
        <span class="n">curir</span> <span class="o">=</span> <span class="n">hrir</span><span class="o">.</span><span class="n">forcoordinates</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">C</span><span class="p">,</span> <span class="n">times</span> <span class="o">=</span> <span class="n">gammatone_correlate</span><span class="p">(</span><span class="n">curir</span><span class="p">,</span> <span class="n">hrir</span><span class="o">.</span><span class="n">samplerate</span><span class="p">,</span> <span class="n">cfs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cfs</span><span class="p">)):</span>
            <span class="n">itds</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">times</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">C</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])]</span>
    <span class="k">return</span> <span class="n">itds</span>

<span class="c">######## Phase ITD</span>
</div>
<span class="k">def</span> <span class="nf">itd_phase</span><span class="p">(</span><span class="n">hrir</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the phase ITD computed as the unwrapped IPD divided by the pulsation.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">freqs</span> <span class="o">=</span>  <span class="n">fftfreq</span><span class="p">(</span><span class="n">hrir</span><span class="o">.</span><span class="n">nsamples</span><span class="p">)</span><span class="o">*</span><span class="n">hrir</span><span class="o">.</span><span class="n">samplerate</span>
    <span class="k">return</span> <span class="n">ipd</span><span class="p">(</span><span class="n">hrir</span><span class="p">,</span> <span class="n">unwrap</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">freqs</span><span class="p">)</span>

<span class="c">######## Onset ITD</span>

<div class="viewcode-block" id="itd_onset"><a class="viewcode-back" href="../../../user/binaural.html#pynaural.binaural.binauralcues.itd_onset">[docs]</a><span class="k">def</span> <span class="nf">itd_onset</span><span class="p">(</span><span class="n">hrir</span><span class="p">,</span> <span class="n">cf</span><span class="p">,</span> <span class="n">threshold</span> <span class="o">=</span> <span class="o">.</span><span class="mi">15</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Computing ITD in bands by just looking at when the IR first reaches ``threshold`` fraction of its maximum. It uses the onset_time method of the ImpulseResponse object.</span>
<span class="sd">    </span>
<span class="sd">    In Duda &amp; Mertens</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">hrir</span><span class="o">.</span><span class="n">ncoordinates</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">hrir</span><span class="o">.</span><span class="n">ncoordinates</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">k</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">itd_onset_bare</span><span class="p">(</span><span class="n">hrir</span><span class="o">.</span><span class="n">forcoordinate</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">cf</span><span class="p">,</span> <span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">res</span><span class="p">,</span><span class="n">itd_onset_bare</span><span class="p">(</span><span class="n">hrir</span><span class="o">.</span><span class="n">forcoordinate</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">cf</span><span class="p">,</span> <span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">T</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">itd_onset_bare</span><span class="p">(</span><span class="n">hrir</span><span class="p">,</span> <span class="n">cf</span><span class="p">,</span> <span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold</span><span class="p">)</span>
</div>
<span class="k">def</span> <span class="nf">itd_onset_bare</span><span class="p">(</span><span class="n">hrir</span><span class="p">,</span> <span class="n">cf</span><span class="p">,</span> <span class="n">threshold</span> <span class="o">=</span> <span class="o">.</span><span class="mi">15</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hrir</span><span class="p">,</span> <span class="n">Sound</span><span class="p">):</span>
        <span class="n">hrir</span> <span class="o">=</span> <span class="n">Sound</span><span class="p">(</span><span class="n">hrir</span><span class="p">,</span> <span class="n">samplerate</span> <span class="o">=</span> <span class="n">hrir</span><span class="o">.</span><span class="n">samplerate</span><span class="p">)</span>

    <span class="n">fb</span> <span class="o">=</span> <span class="n">Gammatone</span><span class="p">(</span><span class="n">Repeat</span><span class="p">(</span><span class="n">hrir</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cf</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">cf</span><span class="p">,</span> <span class="n">cf</span><span class="p">)))</span>
    <span class="n">filtered_hrirset</span> <span class="o">=</span> <span class="n">fb</span><span class="o">.</span><span class="n">process</span><span class="p">()</span>

    <span class="n">itds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">cf</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cf</span><span class="p">)):</span>
        <span class="n">left</span> <span class="o">=</span> <span class="n">ImpulseResponse</span><span class="p">(</span><span class="n">filtered_hrirset</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">hrir</span><span class="o">.</span><span class="n">samplerate</span><span class="p">)</span>
        <span class="n">right</span> <span class="o">=</span> <span class="n">ImpulseResponse</span><span class="p">(</span><span class="n">filtered_hrirset</span><span class="p">[:,</span> <span class="n">i</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">cf</span><span class="p">)],</span> <span class="n">hrir</span><span class="o">.</span><span class="n">samplerate</span><span class="p">)</span>
        <span class="n">delay_left</span> <span class="o">=</span> <span class="n">left</span><span class="o">.</span><span class="n">onset_time</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span>
        <span class="n">delay_right</span> <span class="o">=</span> <span class="n">right</span><span class="o">.</span><span class="n">onset_time</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span>
        <span class="n">itds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">delay_left</span><span class="o">-</span><span class="n">delay_right</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">itds</span>



<span class="c">################# IPD and phase unwrapping</span>
<span class="k">def</span> <span class="nf">ipd</span><span class="p">(</span><span class="n">hrir</span><span class="p">,</span> <span class="n">unwrap</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">positivefreqs</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Computes the phase difference of a binaural ImpulseResponse object.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">hrir_ft</span> <span class="o">=</span> <span class="n">fft</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">hrir</span><span class="p">),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">middle</span> <span class="o">=</span> <span class="n">hrir</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">ipds</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">hrir_ft</span><span class="p">[:,</span> <span class="p">:</span><span class="n">middle</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">hrir_ft</span><span class="p">[:,</span> <span class="n">middle</span><span class="p">:])</span>
    <span class="k">if</span> <span class="n">unwrap</span><span class="p">:</span>
        <span class="n">ipds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">ipds</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">discont</span> <span class="o">=</span> <span class="n">threshold</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ipds</span>
    

<span class="c">######################## ILD ########################</span>
<div class="viewcode-block" id="ild"><a class="viewcode-back" href="../../../user/binaural.html#pynaural.binaural.binauralcues.ild">[docs]</a><span class="k">def</span> <span class="nf">ild</span><span class="p">(</span><span class="n">hrir</span><span class="p">,</span> <span class="n">cf</span><span class="p">,</span> <span class="n">cpu</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Computes the ITDs and ILDs for a given binaural impulse response.</span>
<span class="sd">    </span>
<span class="sd">    Returns the ILD in the same format as an IR object, i.e. an nd array [cf, position]</span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="k">if</span> <span class="n">hrir</span><span class="o">.</span><span class="n">ncoordinates</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">cf</span><span class="p">),</span> <span class="n">hrir</span><span class="o">.</span><span class="n">ncoordinates</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">hrir</span><span class="o">.</span><span class="n">ncoordinates</span><span class="p">):</span>
            <span class="n">res</span><span class="p">[:,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">ild_bare</span><span class="p">(</span><span class="n">hrir</span><span class="o">.</span><span class="n">forcoordinates</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">cf</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ild_bare</span><span class="p">(</span><span class="n">hrir</span><span class="p">,</span> <span class="n">cf</span><span class="p">)</span>
        </div>
<div class="viewcode-block" id="ild_bare"><a class="viewcode-back" href="../../../user/binaural.html#pynaural.binaural.binauralcues.ild_bare">[docs]</a><span class="k">def</span> <span class="nf">ild_bare</span><span class="p">(</span><span class="n">hrir</span><span class="p">,</span> <span class="n">cf</span><span class="p">,</span> <span class="o">**</span><span class="n">kwdargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    ILD computation routine. called by ild that handles multiprocessing,...</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">samplerate</span> <span class="o">=</span> <span class="n">hrir</span><span class="o">.</span><span class="n">samplerate</span>

    <span class="c"># perform some checks and special cases</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">hrir</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">hrir</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cf</span><span class="p">))</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">hrir</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span><span class="o">&lt;=</span> <span class="mf">10e-6</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="ow">or</span>  <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">hrir</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span><span class="o">&lt;=</span><span class="mf">10e-6</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
        <span class="n">log_debug</span><span class="p">(</span><span class="s">&#39;Blank hrirs detected, output will be weird&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hrir</span><span class="p">,</span> <span class="n">Sound</span><span class="p">):</span>
        <span class="n">hrir</span> <span class="o">=</span> <span class="n">Sound</span><span class="p">(</span><span class="n">hrir</span><span class="p">,</span> <span class="n">samplerate</span> <span class="o">=</span> <span class="n">samplerate</span><span class="p">)</span>

    <span class="n">fb</span> <span class="o">=</span> <span class="n">Gammatone</span><span class="p">(</span><span class="n">Repeat</span><span class="p">(</span><span class="n">hrir</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cf</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">cf</span><span class="p">,</span> <span class="n">cf</span><span class="p">)))</span>
    <span class="n">filtered_hrirset</span> <span class="o">=</span> <span class="n">fb</span><span class="o">.</span><span class="n">process</span><span class="p">()</span>
    
    <span class="n">ilds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cf</span><span class="p">)):</span>
        <span class="n">left</span> <span class="o">=</span> <span class="n">filtered_hrirset</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
        <span class="n">right</span> <span class="o">=</span> <span class="n">filtered_hrirset</span><span class="p">[:,</span> <span class="n">i</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">cf</span><span class="p">)]</span>
        <span class="c"># This FFT stuff does a correlate(left, right, &#39;full&#39;)</span>
        <span class="n">Lf</span> <span class="o">=</span> <span class="n">fft</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">left</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">left</span><span class="p">)))))</span>
        <span class="n">Rf</span> <span class="o">=</span> <span class="n">fft</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">right</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">right</span><span class="p">)))))</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">ifft</span><span class="p">(</span><span class="n">Lf</span><span class="o">*</span><span class="n">Rf</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>
        <span class="n">ilds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">C</span><span class="p">)</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">right</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
    <span class="n">ilds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ilds</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ilds</span>

<span class="c"># computes both ITD and ILD using xcorr</span></div>
<div class="viewcode-block" id="bb_itd_ild_xcorr"><a class="viewcode-back" href="../../../user/binaural.html#pynaural.binaural.binauralcues.bb_itd_ild_xcorr">[docs]</a><span class="k">def</span> <span class="nf">bb_itd_ild_xcorr</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    returns ILD in dB, ITD in samples</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">Lf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">left</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">left</span><span class="p">)))))</span>
    <span class="n">Rf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">right</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">right</span><span class="p">)))))</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">Lf</span><span class="o">*</span><span class="n">Rf</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>

    <span class="n">itd_idx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">left</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
    <span class="n">ild</span> <span class="o">=</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">itd_idx</span><span class="p">,</span> <span class="n">ild</span>
</div>
<div class="viewcode-block" id="itd_ild_xcorr"><a class="viewcode-back" href="../../../user/binaural.html#pynaural.binaural.binauralcues.itd_ild_xcorr">[docs]</a><span class="k">def</span> <span class="nf">itd_ild_xcorr</span><span class="p">(</span><span class="n">hrir</span><span class="p">,</span> <span class="n">cf</span><span class="p">,</span> <span class="n">cpu</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Computes the ITDs and ILDs for a given binaural impulse response</span>
<span class="sd">    if hrir is nsamplesx2 then simple</span>
<span class="sd">    else does some multiprocessing to compute the rest, using conventions noted in ImpulseResponse</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hrir</span><span class="p">,</span> <span class="n">ImpulseResponse</span><span class="p">):</span>
        <span class="n">log_debug</span><span class="p">(</span><span class="s">&#39;Starting ITD computations for &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">hrir</span><span class="o">.</span><span class="n">ncoordinates</span><span class="p">)</span><span class="o">+</span><span class="s">&#39; HRIR pairs&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">hrir</span><span class="o">.</span><span class="n">ncoordinates</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">hrir</span><span class="o">.</span><span class="n">ncoordinates</span><span class="p">):</span>
                <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">itd_ild_bare</span><span class="p">(</span><span class="n">hrir</span><span class="o">.</span><span class="n">forcoordinates</span>
<span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">cf</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">res</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">itd_ild_bare</span><span class="p">(</span><span class="n">hrir</span><span class="p">,</span> <span class="n">cf</span><span class="p">)</span>
        </div>
<div class="viewcode-block" id="itd_ild_bare"><a class="viewcode-back" href="../../../user/binaural.html#pynaural.binaural.binauralcues.itd_ild_bare">[docs]</a><span class="k">def</span> <span class="nf">itd_ild_bare</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwdargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    ITD/ILD computation routine. called by itd_ild that handles multiprocessing,...</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="c"># hrir, cf</span>
        <span class="n">hrir</span><span class="p">,</span> <span class="n">cf</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
        <span class="c"># k, shared_data</span>
        <span class="n">shared_data</span> <span class="o">=</span> <span class="n">kwdargs</span><span class="p">[</span><span class="s">&#39;shared_data&#39;</span><span class="p">]</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">hrir</span> <span class="o">=</span> <span class="n">shared_data</span><span class="p">[</span><span class="s">&#39;hrir&#39;</span><span class="p">]</span>
        <span class="n">samplerate</span> <span class="o">=</span> <span class="n">shared_data</span><span class="p">[</span><span class="s">&#39;samplerate&#39;</span><span class="p">]</span>
        <span class="n">cf</span> <span class="o">=</span> <span class="n">shared_data</span><span class="p">[</span><span class="s">&#39;cf&#39;</span><span class="p">]</span>

        <span class="n">hrir</span> <span class="o">=</span> <span class="n">ImpulseResponse</span><span class="p">(</span><span class="n">hrir</span><span class="p">[:,</span> <span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="n">hrir</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">]],</span> 
                               <span class="n">samplerate</span> <span class="o">=</span> <span class="n">samplerate</span><span class="p">)</span>
        
    <span class="n">samplerate</span> <span class="o">=</span> <span class="n">hrir</span><span class="o">.</span><span class="n">samplerate</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">hrir</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">hrir</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cf</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cf</span><span class="p">)))</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">hrir</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span><span class="o">&lt;=</span> <span class="mf">10e-6</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="ow">or</span>  <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">hrir</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span><span class="o">&lt;=</span><span class="mf">10e-6</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
        <span class="n">log_debug</span><span class="p">(</span><span class="s">&#39;Blank hrirs detected, output will be weird&#39;</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hrir</span><span class="p">,</span> <span class="n">Sound</span><span class="p">):</span>
        <span class="n">hrir</span> <span class="o">=</span> <span class="n">Sound</span><span class="p">(</span><span class="n">hrir</span><span class="p">,</span> <span class="n">samplerate</span> <span class="o">=</span> <span class="n">samplerate</span><span class="p">)</span>
        
    
    <span class="n">fb</span> <span class="o">=</span> <span class="n">Gammatone</span><span class="p">(</span><span class="n">Repeat</span><span class="p">(</span><span class="n">hrir</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cf</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">cf</span><span class="p">,</span> <span class="n">cf</span><span class="p">)))</span>
    <span class="n">filtered_hrirset</span> <span class="o">=</span> <span class="n">fb</span><span class="o">.</span><span class="n">process</span><span class="p">()</span>
    <span class="n">itds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ilds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cf</span><span class="p">)):</span>
        <span class="n">left</span> <span class="o">=</span> <span class="n">filtered_hrirset</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
        <span class="n">right</span> <span class="o">=</span> <span class="n">filtered_hrirset</span><span class="p">[:,</span> <span class="n">i</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">cf</span><span class="p">)]</span>
        
        <span class="c"># This FFT stuff does a correlate(left, right, &#39;full&#39;)</span>
        <span class="n">Lf</span> <span class="o">=</span> <span class="n">fft</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">left</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">left</span><span class="p">)))))</span>
        <span class="n">Rf</span> <span class="o">=</span> <span class="n">fft</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">right</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">right</span><span class="p">)))))</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">ifft</span><span class="p">(</span><span class="n">Lf</span><span class="o">*</span><span class="n">Rf</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>
        
        <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">C</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">left</span><span class="p">)</span>
        
        <span class="n">itds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">samplerate</span><span class="p">)</span>
        <span class="n">ilds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">C</span><span class="p">)</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">right</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
        
    <span class="n">itds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">itds</span><span class="p">)</span>
    <span class="n">ilds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ilds</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">itds</span><span class="p">,</span> <span class="n">ilds</span>

<span class="c">################# IPD and phase unwrapping</span></div>
<div class="viewcode-block" id="ipd"><a class="viewcode-back" href="../../../user/binaural.html#pynaural.binaural.binauralcues.ipd">[docs]</a><span class="k">def</span> <span class="nf">ipd</span><span class="p">(</span><span class="n">hrir</span><span class="p">,</span> <span class="n">unwrap</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">positivefreqs</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Computes the phase difference of a binaural ImpulseResponse object.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">hrir_ft</span> <span class="o">=</span> <span class="n">fft</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">hrir</span><span class="p">),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">middle</span> <span class="o">=</span> <span class="n">hrir</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">ipds</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">hrir_ft</span><span class="p">[:,</span> <span class="p">:</span><span class="n">middle</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">hrir_ft</span><span class="p">[:,</span> <span class="n">middle</span><span class="p">:])</span>
    <span class="k">if</span> <span class="n">unwrap</span><span class="p">:</span>
        <span class="n">ipds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">ipds</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">discont</span> <span class="o">=</span> <span class="n">threshold</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ipds</span></div>
</pre></div>

          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          <h3>Table Of Contents</h3>
          <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../user/index.html">User Guide</a></li>
</ul>

          <h3 style="margin-top: 1.5em;">Search</h3>
          <form class="search" action="../../../search.html" method="get">
            <input type="text" name="q" />
            <input type="submit" value="Go" />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
          </form>
          <p class="searchtip" style="font-size: 90%">
            Enter search terms or a module, class or function name.
          </p>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |
          <a href="../../../genindex.html" title="General Index"
             >index</a>
        </div>

        <div class="right">
          
    <div class="footer">
        &copy; Copyright 2013, Victor Benichoux.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>